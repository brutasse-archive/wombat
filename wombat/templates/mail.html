{% extends "base.html" %}
{% load i18n mail_tags %}

{% block title %}{{directory|numberize:"unread" }}{% endblock %}


{% block header %}
<div id="header">
  <div id="search">
    <form action="/search/" method="post" id="search-form">
      {% csrf_token %}
      <p>
        <input type="text" name="search" id="id_search" size="20" value="" />
        <input type="submit" value="Search" />
      </p>
  </form>
  </div>

  <span id="options">
    <b>{{ user.get_profile.emails|first }}</b> |
    <a href="{% url settings %}">Settings</a> |
    <a href="{% url logout %}">Log out</a>
  </span>
</div> <!-- #header -->
{% if messages %}<div id="messages">{% for message in messages %}
	<div class="msg {{ message.tags }}">
		{{ message }}
	</div>{% endfor %}
</div>{% endif %}
{% endblock %}

{% block content %}

<div class="panel">
{% block panel %}
	<div class="actions">
		Select: <a>All, None, Read, Unread, Starred, Unstarred</a>
		<a href="{% url check_directory directory.imap.account.slug directory.id %}">Update</a>
		{% include "inc/messagecount.html" %}
	</div>
  <ul id="messages">
    {% for thread in threads %}
    {% with thread.get_info as m %}
    <li{% if not m.read %} class="new"{% endif %}>
      <input type="checkbox" name="m_{{ m.uid }}" />
      <a href="{% url message directory.imap.account.slug directory.id thread.id %}">
        <span class="from">{{ m.senders|from }}
          {% if thread.messages_count > 1 %}({{ thread.messages_count }}){% endif %}
        </span>
        {{ m.subject|default:"No subject" }}
        <span class="date">{{ m.date|hour_or_date }}</span>
        {% if m.attachment %}<img class="attachment" src="{{ MEDIA_URL }}img/attach.png" alt="paperclip"/>{% endif %}
      </a>
    </li>
    {% endwith %}
    {% empty %}
    <li>{% trans 'Hooray, no message here' %}!</li>
    {% endfor %}
  </ul>
	<div class="actions">
  	Select: <a>All, None, Read, Unread, Starred, Unstarred</a>
	  {% include "inc/messagecount.html" %}
	</div>
{% endblock %}
</div>

{% if err_msg %}
  <p class="errornote">{{ err_msg }}</p>
{% endif %}

{% for account in user.get_profile.accounts.all %}
{% if forloop.first %}
<a href="{% url compose %}">Compose</a>
{% endif %}
<h2><a href="{% url account_inbox account.slug %}">{{ account.name }}</a></h2>
<p><a href="{% url check_mail account.slug %}">Check mail</a></p>

{% with account.common_directories as directories %}
{% include "inc/directory.html" %}
{% endwith %}

{% with account.custom_directories as directories %}
{% include "inc/directory.html" %}
{% endwith %}

{% endfor %}

<div class="clear">&nbsp;</div>
{% endblock %}
